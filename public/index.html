<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <link rel="icon" href="<%= BASE_URL %>favico.ico" />
    <title><%= webpackConfig.name %></title>
  </head>
  <body>
    <noscript>
      <strong
        >We're sorry but <%= webpackConfig.name %> doesn't work properly without
        JavaScript enabled. Please enable it to continue.</strong
      >
    </noscript>
    <div id="app"></div>
    <!-- built files will be auto injected -->
    <script src="https://plantformcdn.fanneng.com/js/ennAuthSdk/1.0.3/enn-auth-sdk.min.js"></script>
    <script src="https://plantformcdn.fanneng.com/js/frontend-monitor-sdk/1.0.1/js/monitor.min.js"></script>
    <script>
      new MonitorJS().init({
        pageId: 'ep-analysis-front',
        env:  MonitorJS.EnnDEV, //上报错误地址
        consoleError:true,
        vueError:true,  //是否上报Vue错误
        vue:Vue,

      });

      new MonitorJS().monitorPerformance({
        pageId: 'ep-analysis-front',
        env:  MonitorJS.EnnDEV, //上报错误地址
        isRXHR:false,
        isPage: true,

      });

      function getDynamicParams(){
        return Math.floor((Math.random()*1000)+1);
      }

      console.tError("123123");  //console_error

      setTimeout(()=>{
        console.tError("333333333333333333");  //console_error
      },200);

      //*
      var vm = new Vue({
        el: '#app',
        data: {
          message: "--------------------------------",
          src3:"https://pic.xiaohuochai.site/blog/chromePerformance2_error.png",
          src4:"",
        },

        created() {
          // this.url='http://10.20.37.200:12800/front/errorLog'
          // this.sendInfo({name:'test'})
          new MonitorJS().initUser({
            name:'wang',
            ticket:'43jn45k2j'
          })
          this.func1().then((ret)=>{
            throw new Error("promise error 22222222222");   //promise_error
          });
          ss();   //vue_error
        },

        mounted() {
          setTimeout(()=>{
            this.src4="https://camo.githubusercontent.com/9f1292f0e9356dab9d9094bca540fd55b1981fa7/68747470733a2f2f75706c6f61642d696d616765732e6a69616e7368752e696f2f75706c6f61645f696d616765732f333239303032382d313534636437373333613061353438362e6a70673f696d6167654d6f6772322f6175746f2d6f7269656e742f7374726970253743696d61676556696577322f322f772f31323430";
          },5000)

        },

        methods: {
          func1(){
            return new Promise((resolve,reject)=>{
              resolve();
            });
          },
          func2(){
            new MonitorJS().monitorPerformance({
              pageId:"ep-analysis-front",
              url:"",    //上报错误地址
              isRXHR:false,
              isPage: true,
            });
          },
          sendInfo(data,isFetch){
            let dataStr = JSON.stringify(data);
            console.log('sendinfo dataStr',dataStr);
            try {
              if(fetch && isFetch){
                fetch(this.url,{
                  headers: {
                    "Content-Type": "application/json"
                  },
                  method:"POST",
                  body:dataStr,
                  mode: 'same-origin', // 告诉浏览器是同源，同源后浏览器不会进行预检请求
                  keepalive:true
                });
                return;
              }
            } catch (error) {
              console.log("fetch请求异常",error);
            }
            try {
              console.log("sendinfo",);
              var xhr = new XMLHttpRequest();
              xhr.open("POST",this.url,true);
              //xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
              xhr.setRequestHeader("Content-Type", "application/json");
              xhr.send(dataStr);
            } catch (error) {
              console.log('sendinfo',error);
            }
          }
        },
      });
      //*/
      ss(); //js_error
    </script>
  </body>
</html>
